(window.webpackJsonp=window.webpackJsonp||[]).push([[10,12],{165:function(t,n){const o={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"frontmatter-markdown"},[o("h1",[t._v("JavaScript深入之闭包")]),t._v(" "),o("blockquote",[o("p",[t._v("JavaScript深入系列第八篇，介绍理论上的闭包和实践上的闭包，以及从作用域链的角度解析经典的闭包题。")])]),t._v(" "),o("h2",[t._v("定义")]),t._v(" "),o("p",[t._v("MDN 对闭包的定义为：")]),t._v(" "),o("blockquote",[o("p",[t._v("闭包是指那些能够访问自由变量的函数。")])]),t._v(" "),o("p",[t._v("那什么是自由变量呢？")]),t._v(" "),o("blockquote",[o("p",[t._v("自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。")])]),t._v(" "),o("p",[t._v("由此，我们可以看出闭包共有两部分组成：")]),t._v(" "),o("blockquote",[o("p",[t._v("闭包 = 函数 + 函数能够访问的自由变量")])]),t._v(" "),o("p",[t._v("举个例子：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" a "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("1")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n\n"),o("span",{staticClass:"token keyword"},[t._v("function")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("foo")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    console"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token function"},[t._v("log")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("a"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n\n"),o("span",{staticClass:"token function"},[t._v("foo")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),t._v(" "),o("p",[t._v("foo 函数可以访问变量 a，但是 a 既不是 foo 函数的局部变量，也不是 foo 函数的参数，所以 a 就是自由变量。")]),t._v(" "),o("p",[t._v("那么，函数 foo + foo 函数访问的自由变量 a 不就是构成了一个闭包嘛……")]),t._v(" "),o("p",[t._v("还真是这样的！")]),t._v(" "),o("p",[t._v("所以在《JavaScript权威指南》中就讲到：从技术的角度讲，所有的JavaScript函数都是闭包。")]),t._v(" "),o("p",[t._v("咦，这怎么跟我们平时看到的讲到的闭包不一样呢！？")]),t._v(" "),o("p",[t._v("别着急，这是理论上的闭包，其实还有一个实践角度上的闭包，让我们看看汤姆大叔翻译的关于闭包的文章中的定义：")]),t._v(" "),o("p",[t._v("ECMAScript中，闭包指的是：")]),t._v(" "),o("ol",[o("li",[t._v("从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。")]),t._v(" "),o("li",[t._v("从实践角度：以下函数才算是闭包：\n"),o("ol",[o("li",[t._v("即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）")]),t._v(" "),o("li",[t._v("在代码中引用了自由变量")])])])]),t._v(" "),o("p",[t._v("接下来就来讲讲实践上的闭包。")]),t._v(" "),o("h2",[t._v("分析")]),t._v(" "),o("p",[t._v("让我们先写个例子，例子依然是来自《JavaScript权威指南》，稍微做点改动：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" scope "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token string"},[t._v('"global scope"')]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token keyword"},[t._v("function")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("checkscope")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" scope "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token string"},[t._v('"local scope"')]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n    "),o("span",{staticClass:"token keyword"},[t._v("function")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("f")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),o("span",{staticClass:"token keyword"},[t._v("return")]),t._v(" scope"),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n    "),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n    "),o("span",{staticClass:"token keyword"},[t._v("return")]),t._v(" f"),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n\n"),o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" foo "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token function"},[t._v("checkscope")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token function"},[t._v("foo")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),t._v(" "),o("p",[t._v("首先我们要分析一下这段代码中执行上下文栈和执行上下文的变化情况。")]),t._v(" "),o("p",[t._v("另一个与这段代码相似的例子，在"),o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/8",target:"_blank"}},[t._v("《JavaScript深入之执行上下文》")]),t._v("中有着非常详细的分析。如果看不懂以下的执行过程，建议先阅读这篇文章。")]),t._v(" "),o("p",[t._v("这里直接给出简要的执行过程：")]),t._v(" "),o("ol",[o("li",[t._v("进入全局代码，创建全局执行上下文，全局执行上下文压入执行上下文栈")]),t._v(" "),o("li",[t._v("全局执行上下文初始化")]),t._v(" "),o("li",[t._v("执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 执行上下文被压入执行上下文栈")]),t._v(" "),o("li",[t._v("checkscope 执行上下文初始化，创建变量对象、作用域链、this等")]),t._v(" "),o("li",[t._v("checkscope 函数执行完毕，checkscope 执行上下文从执行上下文栈中弹出")]),t._v(" "),o("li",[t._v("执行 f 函数，创建 f 函数执行上下文，f 执行上下文被压入执行上下文栈")]),t._v(" "),o("li",[t._v("f 执行上下文初始化，创建变量对象、作用域链、this等")]),t._v(" "),o("li",[t._v("f 函数执行完毕，f 函数上下文从执行上下文栈中弹出")])]),t._v(" "),o("p",[t._v("了解到这个过程，我们应该思考一个问题，那就是：")]),t._v(" "),o("p",[t._v("当 f 函数执行的时候，checkscope 函数上下文已经被销毁了啊(即从执行上下文栈中被弹出)，怎么还会读取到 checkscope 作用域下的 scope 值呢？")]),t._v(" "),o("p",[t._v("以上的代码，要是转换成 PHP，就会报错，因为在 PHP 中，f 函数只能读取到自己作用域和全局作用域里的值，所以读不到 checkscope 下的 scope 值。(这段我问的PHP同事……)")]),t._v(" "),o("p",[t._v("然而 JavaScript 却是可以的！")]),t._v(" "),o("p",[t._v("当我们了解了具体的执行过程后，我们知道 f 执行上下文维护了一个作用域链：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("fContext "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    Scope"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token constant"},[t._v("AO")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" checkscopeContext"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token constant"},[t._v("AO")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" globalContext"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token constant"},[t._v("VO")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("对的，就是因为这个作用域链，f 函数依然可以读取到 checkscopeContext.AO 的值，说明当 f 函数引用了 checkscopeContext.AO 中的值的时候，即使 checkscopeContext 被销毁了，但是 JavaScript 依然会让 checkscopeContext.AO 活在内存中，f 函数依然可以通过 f 函数的作用域链找到它，正是因为 JavaScript 做到了这一点，从而实现了闭包这个概念。")]),t._v(" "),o("p",[t._v("所以，让我们再看一遍实践角度上闭包的定义：")]),t._v(" "),o("ol",[o("li",[t._v("即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）")]),t._v(" "),o("li",[t._v("在代码中引用了自由变量")])]),t._v(" "),o("p",[t._v("在这里再补充一个《JavaScript权威指南》英文原版对闭包的定义:")]),t._v(" "),o("blockquote",[o("p",[t._v("This combination of a function object and a scope (a set of variable bindings) in which the function’s variables are resolved is called a closure in the computer science literature.")])]),t._v(" "),o("p",[t._v("闭包在计算机科学中也只是一个普通的概念，大家不要去想得太复杂。")]),t._v(" "),o("h2",[t._v("必刷题")]),t._v(" "),o("p",[t._v("接下来，看这道刷题必刷，面试必考的闭包题：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" data "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n\n"),o("span",{staticClass:"token keyword"},[t._v("for")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" i "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v(" i "),o("span",{staticClass:"token operator"},[t._v("<")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("3")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v(" i"),o("span",{staticClass:"token operator"},[t._v("++")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n  data"),o("span",{staticClass:"token punctuation"},[t._v("[")]),t._v("i"),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("function")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    console"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token function"},[t._v("log")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("i"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n  "),o("span",{staticClass:"token punctuation"},[t._v("}")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("1")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("2")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),t._v(" "),o("p",[t._v("答案是都是 3，让我们分析一下原因：")]),t._v(" "),o("p",[t._v("当执行到 data[0] 函数之前，此时全局上下文的 VO 为：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("globalContext "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),o("span",{staticClass:"token constant"},[t._v("VO")]),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        data"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token operator"},[t._v("...")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        i"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("3")]),t._v("\n    "),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("当执行 data[0] 函数的时候，data[0] 函数的作用域链为：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("data"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("Context "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    Scope"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token constant"},[t._v("AO")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" globalContext"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token constant"},[t._v("VO")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("data[0]Context 的 AO 并没有 i 值，所以会从 globalContext.VO 中查找，i 为 3，所以打印的结果就是 3。")]),t._v(" "),o("p",[t._v("data[1] 和 data[2] 是一样的道理。")]),t._v(" "),o("p",[t._v("所以让我们改成闭包看看：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" data "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n\n"),o("span",{staticClass:"token keyword"},[t._v("for")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token keyword"},[t._v("var")]),t._v(" i "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v(" i "),o("span",{staticClass:"token operator"},[t._v("<")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("3")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v(" i"),o("span",{staticClass:"token operator"},[t._v("++")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n  data"),o("span",{staticClass:"token punctuation"},[t._v("[")]),t._v("i"),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v(" "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token keyword"},[t._v("function")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token parameter"},[t._v("i")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        "),o("span",{staticClass:"token keyword"},[t._v("return")]),t._v(" "),o("span",{staticClass:"token keyword"},[t._v("function")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n            console"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token function"},[t._v("log")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("i"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n        "),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n  "),o("span",{staticClass:"token punctuation"},[t._v("}")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),t._v("i"),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("1")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\ndata"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("2")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v("(")]),o("span",{staticClass:"token punctuation"},[t._v(")")]),o("span",{staticClass:"token punctuation"},[t._v(";")]),t._v("\n")])]),t._v(" "),o("p",[t._v("当执行到 data[0] 函数之前，此时全局上下文的 VO 为：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("globalContext "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),o("span",{staticClass:"token constant"},[t._v("VO")]),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        data"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token operator"},[t._v("...")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        i"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("3")]),t._v("\n    "),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("跟没改之前一模一样。")]),t._v(" "),o("p",[t._v("当执行 data[0] 函数的时候，data[0] 函数的作用域链发生了改变：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("data"),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("Context "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    Scope"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("[")]),o("span",{staticClass:"token constant"},[t._v("AO")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v(" 匿名函数Context"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token constant"},[t._v("AO")]),t._v(" globalContext"),o("span",{staticClass:"token punctuation"},[t._v(".")]),o("span",{staticClass:"token constant"},[t._v("VO")]),o("span",{staticClass:"token punctuation"},[t._v("]")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("匿名函数执行上下文的 AO 为：")]),t._v(" "),o("pre",{staticClass:"language-js"},[o("code",{staticClass:"language-js"},[t._v("匿名函数Context "),o("span",{staticClass:"token operator"},[t._v("=")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n    "),o("span",{staticClass:"token constant"},[t._v("AO")]),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n        arguments"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token punctuation"},[t._v("{")]),t._v("\n            "),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("0")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n            length"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("1")]),t._v("\n        "),o("span",{staticClass:"token punctuation"},[t._v("}")]),o("span",{staticClass:"token punctuation"},[t._v(",")]),t._v("\n        i"),o("span",{staticClass:"token operator"},[t._v(":")]),t._v(" "),o("span",{staticClass:"token number"},[t._v("0")]),t._v("\n    "),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n"),o("span",{staticClass:"token punctuation"},[t._v("}")]),t._v("\n")])]),t._v(" "),o("p",[t._v("data[0]Context 的 AO 并没有 i 值，所以会沿着作用域链从匿名函数 Context.AO 中查找，这时候就会找 i 为 0，找到了就不会往 globalContext.VO 中查找了，即使 globalContext.VO 也有 i 的值(值为3)，所以打印的结果就是 0。")]),t._v(" "),o("p",[t._v("data[1] 和 data[2] 是一样的道理。")]),t._v(" "),o("h2",[t._v("下一篇文章")]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/10",target:"_blank"}},[t._v("JavaScript深入之参数按值传递")])]),t._v(" "),o("h2",[t._v("相关链接")]),t._v(" "),o("p",[t._v("如果想了解执行上下文的具体变化，不妨循序渐进，阅读这六篇：")]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/3",target:"_blank"}},[t._v("《JavaScript深入之词法作用域和动态作用域》")])]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/4",target:"_blank"}},[t._v("《JavaScript深入之执行上下文栈》")])]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/5",target:"_blank"}},[t._v("《JavaScript深入之变量对象》")])]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/6",target:"_blank"}},[t._v("《JavaScript深入之作用域链》")])]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/7",target:"_blank"}},[t._v("《JavaScript深入之从ECMAScript规范解读this》")])]),t._v(" "),o("p",[o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog/issues/8",target:"_blank"}},[t._v("《JavaScript深入之执行上下文》")])]),t._v(" "),o("h2",[t._v("深入系列")]),t._v(" "),o("p",[t._v("JavaScript深入系列目录地址："),o("a",{attrs:{href:"https://github.com/mqyqingfeng/Blog",target:"_blank"}},[t._v("https://github.com/mqyqingfeng/Blog")]),t._v("。")]),t._v(" "),o("p",[t._v("JavaScript深入系列预计写十五篇左右，旨在帮大家捋顺JavaScript底层知识，重点讲解如原型、作用域、执行上下文、变量对象、this、闭包、按值传递、call、apply、bind、new、继承等难点概念。")]),t._v(" "),o("p",[t._v("如果有错误或者不严谨的地方，请务必给予指正，十分感谢。如果喜欢或者有所启发，欢迎star，对作者也是一种鼓励。")])])}]};t.exports={attributes:{name:"jQuery",title:"JavaScript深入之闭包",time:"2020年3月2日",id:"bacon-ipsum",description:"JavaScript深入系列第八篇，介绍理论上的闭包和实践上的闭包，以及从作用域链的角度解析经典的闭包题。"},meta:{resourcePath:"G:\\projects\\nuxt-blog\\contents\\javascript深入之闭包.md"},vue:{component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=o.render,this.$options.staticRenderFns=o.staticRenderFns}}}}},166:function(t,n,o){var map={"./javascript专题之jquery通用遍历方法each的实现.md":167,"./javascript深入之bind的模拟实现.md":168,"./javascript深入之call和apply的模拟实现.md":169,"./javascript深入之new的模拟实现.md":170,"./javascript深入之闭包.md":165};function c(t){var n=e(t);return o(n)}function e(t){if(!o.o(map,t)){var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}return map[t]}c.keys=function(){return Object.keys(map)},c.resolve=e,t.exports=c,c.id=166},173:function(t,n,o){var content=o(183);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(15).default)("650a8785",content,!0,{sourceMap:!1})},174:function(t,n,o){var content=o(185);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(15).default)("4a6933ef",content,!0,{sourceMap:!1})},175:function(t,n,o){var content=o(187);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(15).default)("52d0494f",content,!0,{sourceMap:!1})},181:function(t,n,o){t.exports=o.p+"img/2fb4f73.png"},182:function(t,n,o){"use strict";var c=o(173);o.n(c).a},183:function(t,n,o){(n=o(14)(!1)).push([t.i,".NuxtLogo{-webkit-animation:appear 1s;animation:appear 1s}@-webkit-keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes appear{0%{opacity:0}to{opacity:1}}",""]),t.exports=n},184:function(t,n,o){"use strict";var c=o(174);o.n(c).a},185:function(t,n,o){(n=o(14)(!1)).push([t.i,".NetlifyLogo{-webkit-animation:appear 1s;animation:appear 1s}@-webkit-keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes appear{0%{opacity:0}to{opacity:1}}",""]),t.exports=n},186:function(t,n,o){"use strict";var c=o(175);o.n(c).a},187:function(t,n,o){(n=o(14)(!1)).push([t.i,".GiteeLogo{-webkit-animation:appear 1s;animation:appear 1s}@-webkit-keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes appear{0%{opacity:0}to{opacity:1}}",""]),t.exports=n},188:function(t,n,o){"use strict";o.r(n);o(23),o(16),o(182);var c=o(5),e=Object(c.a)({},(function(){var t=this.$createElement,n=this._self._c||t;return n("svg",{staticClass:"NuxtLogo",attrs:{width:"245",height:"180",viewBox:"0 0 452 342",xmlns:"http://www.w3.org/2000/svg"}},[n("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[n("path",{attrs:{d:"M139 330l-1-2c-2-4-2-8-1-13H29L189 31l67 121 22-16-67-121c-1-2-9-14-22-14-6 0-15 2-22 15L5 303c-1 3-8 16-2 27 4 6 10 12 24 12h136c-14 0-21-6-24-12z",fill:"#00C58E"}}),this._v(" "),n("path",{attrs:{d:"M447 304L317 70c-2-2-9-15-22-15-6 0-15 3-22 15l-17 28v54l39-67 129 230h-49a23 23 0 0 1-2 14l-1 1c-6 11-21 12-23 12h76c3 0 17-1 24-12 3-5 5-14-2-26z",fill:"#108775"}}),this._v(" "),n("path",{attrs:{d:"M376 330v-1l1-2c1-4 2-8 1-12l-4-12-102-178-15-27h-1l-15 27-102 178-4 12a24 24 0 0 0 2 15c4 6 10 12 24 12h190c3 0 18-1 25-12zM256 152l93 163H163l93-163z",fill:"#2F495E","fill-rule":"nonzero"}})])])}),[],!1,null,null,null).exports,v=(o(184),Object(c.a)({},(function(){var t=this.$createElement,n=this._self._c||t;return n("svg",{staticClass:"NetlifyLogo",attrs:{width:"200",height:"200",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"}},[n("defs",[n("radialGradient",{attrs:{id:"IconifyId-17099b27e25-8efc3c-3",cx:"50%",cy:"-50%",fx:"50%",fy:"-50%",r:"100%"}},[n("stop",{attrs:{"stop-color":"#20C6B7",offset:"0%"}}),this._v(" "),n("stop",{attrs:{"stop-color":"#4D9ABF",offset:"100%"}})],1)],1),this._v(" "),n("path",{attrs:{d:"M185.532 88.839l-.094-.04a.396.396 0 0 1-.154-.087a.734.734 0 0 1-.187-.621l5.167-31.553l24.229 24.209l-25.198 10.709a.555.555 0 0 1-.22.04h-.101a.694.694 0 0 1-.134-.114a11.468 11.468 0 0 0-3.308-2.543zm35.144-1.923l25.906 25.878c5.38 5.381 8.075 8.065 9.057 11.177c.147.46.267.921.361 1.395l-61.913-26.192a4.868 4.868 0 0 0-.1-.04c-.248-.1-.535-.214-.535-.467c0-.254.294-.374.541-.474l.08-.034l26.603-11.243zm34.268 46.756c-1.337 2.51-3.944 5.114-8.355 9.527l-29.209 29.17l-37.777-7.858l-.2-.04c-.335-.054-.689-.114-.689-.414a11.387 11.387 0 0 0-4.378-7.965c-.154-.154-.113-.394-.067-.615c0-.033 0-.066.014-.093l7.105-43.571l.026-.147c.04-.334.1-.721.401-.721a11.566 11.566 0 0 0 7.754-4.44c.06-.067.1-.14.18-.18c.214-.1.468 0 .689.093l64.5 27.254h.006zm-44.28 45.407l-48.031 47.978l8.22-50.475l.014-.067a.905.905 0 0 1 .04-.193c.067-.16.24-.227.408-.294l.08-.034c1.8-.767 3.392-1.95 4.646-3.451c.16-.187.354-.368.601-.401c.064-.01.13-.01.194 0l33.82 6.944l.007-.007zm-58.198 58.133l-5.414 5.408l-59.854-86.408a2.831 2.831 0 0 0-.067-.094c-.093-.127-.194-.253-.173-.4c.006-.107.073-.2.147-.28l.066-.087c.18-.268.335-.535.502-.822l.133-.233l.02-.02c.094-.16.18-.314.341-.401c.14-.067.335-.04.488-.007l66.311 13.66c.186.03.36.105.508.22c.087.088.107.181.127.288a11.735 11.735 0 0 0 6.871 7.845c.187.093.107.3.02.52a1.588 1.588 0 0 0-.1.301c-.835 5.074-8 48.726-9.926 60.51zm-11.309 11.29c-3.99 3.946-6.343 6.035-9.003 6.877a13.382 13.382 0 0 1-8.06 0c-3.115-.989-5.809-3.672-11.19-9.054l-60.108-60.042l15.7-24.323a1 1 0 0 1 .268-.314c.167-.12.408-.066.608 0a16.285 16.285 0 0 0 10.948-.554c.18-.066.361-.113.502.014c.07.064.133.135.187.213l60.148 87.19v-.007zm-94.156-68.008l-13.789-13.773l27.23-11.604a.562.562 0 0 1 .221-.047c.227 0 .361.227.481.434c.274.42.564.83.87 1.229l.086.106c.08.114.027.227-.053.334l-15.04 23.321h-.006zM27.11 160.625L9.665 143.199c-2.968-2.964-5.12-5.114-6.617-6.963l53.043 10.99l.2.033c.328.053.69.113.69.42c0 .334-.395.488-.73.614l-.153.067l-28.988 12.265zM0 127.275a13.34 13.34 0 0 1 .602-3.304c.989-3.112 3.676-5.796 9.063-11.177l22.324-22.3a14524.43 14524.43 0 0 0 30.92 44.647c.18.24.38.507.174.707c-.976 1.075-1.952 2.25-2.64 3.526c-.075.163-.19.306-.335.413c-.087.054-.18.034-.28.014h-.014L0 127.269v.007zm37.965-42.75l30.017-29.984c2.82 1.235 13.087 5.568 22.27 9.44c6.952 2.939 13.288 5.61 15.28 6.477c.2.08.381.16.468.36c.053.12.027.274 0 .401a13.363 13.363 0 0 0 3.496 12.205c.2.2 0 .487-.174.734l-.094.14l-30.478 47.157c-.08.134-.154.247-.288.334c-.16.1-.387.053-.575.007a15.215 15.215 0 0 0-3.629-.494c-1.096 0-2.286.2-3.489.42h-.007c-.133.02-.254.047-.36-.033a1.403 1.403 0 0 1-.301-.34L37.965 84.525zm36.08-36.04l38.86-38.817c5.38-5.375 8.074-8.065 11.188-9.047a13.382 13.382 0 0 1 8.061 0c3.115.982 5.808 3.672 11.189 9.047l8.422 8.413l-27.638 42.756a1.035 1.035 0 0 1-.274.32c-.167.114-.401.067-.602 0a14.028 14.028 0 0 0-12.833 2.471c-.18.187-.448.08-.675-.02c-3.61-1.569-31.682-13.42-35.699-15.122zm83.588-24.542l25.52 25.49l-6.15 38.044v.1a.9.9 0 0 1-.053.254c-.067.133-.201.16-.335.2a12.237 12.237 0 0 0-3.662 1.823a1.029 1.029 0 0 0-.134.113c-.074.08-.147.154-.267.167a.763.763 0 0 1-.288-.047l-38.887-16.504l-.073-.034c-.248-.1-.542-.22-.542-.474a14.664 14.664 0 0 0-2.072-6.109c-.187-.307-.394-.627-.234-.941l27.177-42.082zM131.352 81.4l36.454 15.423c.2.093.421.18.508.387a.707.707 0 0 1 0 .38c-.107.535-.2 1.142-.2 1.757v1.021c0 .254-.261.36-.502.46l-.073.027c-5.775 2.464-81.076 34.538-81.19 34.538c-.113 0-.234 0-.347-.113c-.2-.2 0-.48.18-.735l.094-.133l29.957-46.335l.053-.08c.174-.281.375-.595.696-.595l.3.047c.682.093 1.284.18 1.892.18c4.545 0 8.756-2.21 11.296-5.989c.06-.1.137-.19.227-.267c.18-.133.448-.066.655.027zm-41.748 61.324l82.079-34.965s.12 0 .234.114c.447.447.828.747 1.196 1.028l.18.113c.168.094.335.2.348.374c0 .067 0 .107-.013.167l-7.032 43.144l-.027.174c-.046.333-.093.714-.407.714a11.558 11.558 0 0 0-9.177 5.655l-.034.053c-.093.154-.18.3-.334.38c-.14.068-.32.041-.468.008l-65.455-13.487c-.067-.013-1.016-3.465-1.09-3.472z",fill:"url(#IconifyId-17099b27e25-8efc3c-3)"}})])}),[],!1,null,null,null).exports),_=(o(186),Object(c.a)({},(function(){var t=this.$createElement,n=this._self._c||t;return n("svg",{staticClass:"GiteeLogo",attrs:{width:"200",height:"200",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M891 428.8H465.8c-20.4 0-37 16.5-37 37v92.4c0 20.4 16.5 37 37 37h258.9c20.4 0 37 16.6 37 37v18.4c0 61.3-49.7 110.9-110.9 110.9H299.4c-20.4 0-37-16.6-37-37V373.2c0-61.3 49.7-110.9 110.9-110.9h517.6c20.4 0 37-16.5 37-37l0.1-92.3c0-20.4-16.5-37-37-37H373.3C220.2 96 96 220.2 96 373.3V891c0 20.4 16.6 37 37 37h545.4C816.2 928 928 816.3 928 678.4V465.8c0-20.4-16.6-37-37-37z",fill:"#d81e06","p-id":"2752"}})])}),[],!1,null,null,null).exports),l=[{comp:"LogoNuxt",title:"由Nuxt提供技术支持",desc:"本博客使用了 Nuxt 框架生成静态页面",link:"https://zh.nuxtjs.org/guide"},{comp:"LogoNetlify",title:"部署于Netlify",desc:"优秀的内容管理网站，能实现网页快速部署",link:"https://www.netlify.com/"},{comp:"LogoGitee",title:"源码已开源",desc:"所有代码已托管至码云仓库，欢迎交流学习",link:"https://gitee.com/chinesee/blog-nuxt"}],r={components:{LogoNuxt:e,LogoNetlify:v,LogoGitee:_},asyncData:function(){var t=o(166);return{blogs:t.keys().map((function(n){var o=t(n);return{attributes:o.attributes,meta:o.meta}}))}},data:function(){return{logos:l}}},k=Object(c.a)(r,(function(){var t=this,n=t.$createElement,c=t._self._c||n;return c("div",{staticClass:"index pt-6"},[c("div",[c("div",{staticClass:"py-10 flex justify-center items-center"},[c("div",{staticClass:"md:mr-20"},[t._m(0),t._v(" "),t._m(1),t._v(" "),c("ns-button",{on:{click:function(n){return t.$router.push("/creations")}}},[t._v("查看我的作品")])],1),t._v(" "),c("img",{staticClass:"hidden sm:inline-block",staticStyle:{width:"500px"},attrs:{src:o(181),alt:"首页图片"}})]),t._v(" "),c("div",{staticClass:"flex justify-center items-center"},t._l(t.logos,(function(n,i){var o=n.comp,title=n.title,desc=n.desc,link=n.link;return c("div",{key:i,staticClass:"mx-12 flex items-center"},[c(o,{tag:"component",staticClass:"w-12 mr-4"}),t._v(" "),c("div",[c("p",{staticClass:"mb-1 text-lg text-gray-600 font-bold "},[c("a",{attrs:{target:"_blank",href:link}},[t._v(t._s(title))])]),t._v(" "),c("p",{staticClass:"w-40 text-xs text-gray-500"},[t._v(t._s(desc))])])],1)})),0)])])}),[function(){var t=this.$createElement,n=this._self._c||t;return n("p",{staticClass:"text-gray-700 text-3xl font-bold"},[this._v("\n          生命相承，殊途同归 "),n("br"),this._v("\n          世事变幻，但时间从不作答\n        ")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",{staticClass:"mt-4 mb-10 text-gray-600 text-sm"},[this._v("\n          朽骨已在掩埋的宅邸中躺了多久，但纪念碑将于此山谷中永垂不朽。"),n("br"),this._v("\n          孤勇之后，世界尽在眼前。\n        ")])}],!1,null,null,null);n.default=k.exports}}]);